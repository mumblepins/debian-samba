Goal: Fix possible XSS attack in SWAT

Fixes: Upstream security fix. CVE-2011-2694

Status wrt upstream: Fixed in 3.5.10

Author: Kai Blin <kai@samba.org>

Ported to 2:3.2.5-4lenny14 by Florian Weimer <fw@deneb.enyo.de>

diff --git a/source/web/swat.c b/source/web/swat.c
index 15e2e26..1e88547 100644
--- a/source/web/swat.c
+++ b/source/web/swat.c
@@ -1224,11 +1224,9 @@ static void chg_passwd(void)
 	if(cgi_variable(CHG_S_PASSWD_FLAG)) {
 		printf("<p>");
 		if (rslt == True) {
-			printf(_(" The passwd for '%s' has been changed."), cgi_variable_nonull(SWAT_USER));
-			printf("\n");
+			printf("%s\n", _(" The passwd has been changed."));
 		} else {
-			printf(_(" The passwd for '%s' has NOT been changed."), cgi_variable_nonull(SWAT_USER));
-			printf("\n");
+			printf("%s\n", _(" The passwd has NOT been changed."));
 		}
 	}
 	
@@ -1242,14 +1240,6 @@ static void passwd_page(void)
 {
 	const char *new_name = cgi_user_name();
 
-	/* 
-	 * After the first time through here be nice. If the user
-	 * changed the User box text to another users name, remember it.
-	 */
-	if (cgi_variable(SWAT_USER)) {
-		new_name = cgi_variable_nonull(SWAT_USER);
-	} 
-
 	if (!new_name) new_name = "";
 
 	printf("<H2>%s</H2>\n", _("Server Password Management"));
