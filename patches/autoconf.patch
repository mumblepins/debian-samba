Goal: move changes to autogenerated files into their own patch now that we've
      lost the script that was calling autogen.sh for us; this also helps
      make debian/rules clean just a little bit cleaner.

Fixes: no specific bug

Status wrt upstream: Debian specific

Note: This patch will normally have to be updated by hand after every
      new upstream release and after updates of any other patches that
      touch configure.in -- the first because configure scripts don't
      hold patches well between updates, the second so that our changes
      are recognized in the version of the script actually used in the
      build process.

      The process for refreshing this patch is:

 export QUILT_PATCHES=debian/patches
 quilt push autoconf.patch # to get everything applied up to this point
 quilt push -f autoconf.patch # to override the errors when applying
 (cd source && autoconf -I lib/replace)
   # the -I lib/replace is needed because upstream seems to have done
   # something screwy with where their m4 include files are distributed in the
   # source tree; so this option may not be necessary in the future
 quilt refresh
 find . -name '*.rej' | xargs rm

Index: samba-3.0.29/source/configure
===================================================================
--- samba-3.0.29.orig/source/configure
+++ samba-3.0.29/source/configure
@@ -671,6 +671,9 @@
 logfilebase
 privatedir
 swatdir
+codepagedir
+statedir
+cachedir
 rootsbindir
 pammodulesdir
 SAMBA_CPPFLAGS
@@ -2151,7 +2154,7 @@
 if test "${with_fhs+set}" = set; then
   withval=$with_fhs;  case "$withval" in
   yes)
-    lockdir="\${VARDIR}/lib/samba"
+    lockdir="\${VARDIR}/run/samba"
     piddir="\${VARDIR}/run"
     mandir="\${prefix}/share/man"
     logfilebase="\${VARDIR}/log/samba"
@@ -2159,6 +2162,14 @@
     libdir="\${prefix}/lib/samba"
     configdir="\${sysconfdir}/samba"
     swatdir="\${DATADIR}/samba/swat"
+    codepagedir="\${DATADIR}/samba"
+    statedir="\${VARDIR}/lib/samba"
+    cachedir="\${VARDIR}/cache/samba"
+
+cat >>confdefs.h <<\_ACEOF
+#define FHS_COMPATIBLE 1
+_ACEOF
+
     ;;
   esac
 fi
@@ -2462,6 +2473,9 @@
 
 
 
+
+
+
 ## check for --enable-debug first before checking CFLAGS before
 ## so that we don't mix -O and -g
 # Check whether --enable-debug was given.
@@ -11616,6 +11630,27 @@
       fi
     ;;
 
+# Systems with LFS support.
+#
+    gnu* | k*bsd*-gnu)
+	CPPFLAGS="-D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE $CPPFLAGS"
+
+cat >>confdefs.h <<\_ACEOF
+#define _LARGEFILE64_SOURCE 1
+_ACEOF
+
+
+cat >>confdefs.h <<\_ACEOF
+#define _FILE_OFFSET_BITS 64
+_ACEOF
+
+
+cat >>confdefs.h <<\_ACEOF
+#define _GNU_SOURCE 1
+_ACEOF
+
+	;;
+
 # Tests for linux LFS support. Need kernel 2.4 and glibc2.2 or greater support.
 #
     *linux*)
@@ -34669,7 +34704,7 @@
 #
 #
 case "$host_os" in
-    *linux*)
+    linux*-gnu* | gnu* | k*bsd*-gnu)
        # glibc <= 2.3.2 has a broken getgrouplist
        if test "$cross_compiling" = yes; then
   { { echo "$as_me:$LINENO: error: cannot run test program while cross compiling
@@ -39577,11 +39612,14 @@
 
   # and these are for particular systems
   case "$host_os" in
-		*linux*)
+		linux*-gnu* | gnu* | k*bsd*-gnu)
+			case "$host_os" in linux*)
+
 cat >>confdefs.h <<\_ACEOF
 #define LINUX 1
 _ACEOF
-
+ ;;
+			esac
 			BLDSHARED="true"
 			if test "${ac_cv_gnu_ld_no_default_allow_shlib_undefined}" = "yes"; then
 				LDSHFLAGS="-shared -Wl,-Bsymbolic -Wl,--allow-shlib-undefined"
@@ -62312,7 +62350,7 @@
 echo "${ECHO_T}yes" >&6; };
 
 	case "$host_os" in
-	*linux*)
+	linux*-gnu* | gnu* | k*bsd*-gnu)
 		{ echo "$as_me:$LINENO: checking for linux sendfile64 support" >&5
 echo $ECHO_N "checking for linux sendfile64 support... $ECHO_C" >&6; }
 if test "${samba_cv_HAVE_SENDFILE64+set}" = set; then
@@ -63334,11 +63372,11 @@
 SMB_KRB5_LOCATOR="bin/smb_krb5_locator.$SHLIBEXT"
 
 case "$host_os" in
-	*linux*)
+	linux*-gnu* | gnu* | k*bsd*-gnu)
 		NSSSONAMEVERSIONSUFFIX=".2"
 		WINBIND_NSS_EXTRA_OBJS="nsswitch/winbind_nss_linux.o"
 		;;
-	*freebsd[5-9]*)
+	freebsd5*|*freebsd[6-9]*)
 		# FreeBSD winbind client is implemented as a wrapper around
 		# the Linux version.
 		NSSSONAMEVERSIONSUFFIX=".1"
@@ -67895,6 +67933,9 @@
 logfilebase!$logfilebase$ac_delim
 privatedir!$privatedir$ac_delim
 swatdir!$swatdir$ac_delim
+codepagedir!$codepagedir$ac_delim
+statedir!$statedir$ac_delim
+cachedir!$cachedir$ac_delim
 rootsbindir!$rootsbindir$ac_delim
 pammodulesdir!$pammodulesdir$ac_delim
 SAMBA_CPPFLAGS!$SAMBA_CPPFLAGS$ac_delim
@@ -67932,9 +67973,6 @@
 PASSDB_LIBS!$PASSDB_LIBS$ac_delim
 IDMAP_LIBS!$IDMAP_LIBS$ac_delim
 KRB5_LIBS!$KRB5_LIBS$ac_delim
-UUID_LIBS!$UUID_LIBS$ac_delim
-LDAP_LIBS!$LDAP_LIBS$ac_delim
-PAM_MODULES!$PAM_MODULES$ac_delim
 _ACEOF
 
   if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 97; then
@@ -67976,6 +68014,9 @@
 ac_delim='%!_!# '
 for ac_last_try in false false false false false :; do
   cat >conf$$subs.sed <<_ACEOF
+UUID_LIBS!$UUID_LIBS$ac_delim
+LDAP_LIBS!$LDAP_LIBS$ac_delim
+PAM_MODULES!$PAM_MODULES$ac_delim
 INSTALL_PAM_MODULES!$INSTALL_PAM_MODULES$ac_delim
 UNINSTALL_PAM_MODULES!$UNINSTALL_PAM_MODULES$ac_delim
 NSS_MODULES!$NSS_MODULES$ac_delim
@@ -68060,7 +68101,7 @@
 LTLIBOBJS!$LTLIBOBJS$ac_delim
 _ACEOF
 
-  if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 82; then
+  if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 85; then
     break
   elif $ac_last_try; then
     { { echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
Index: samba-3.0.29/source/include/config.h.in
===================================================================
--- samba-3.0.29.orig/source/include/config.h.in
+++ samba-3.0.29/source/include/config.h.in
@@ -57,6 +57,9 @@
 /* Define to turn on dmalloc debugging */
 #undef ENABLE_DMALLOC
 
+/* Whether to use fully FHS-compatible paths */
+#undef FHS_COMPATIBLE
+
 /* Whether the host os is FreeBSD */
 #undef FREEBSD
 
