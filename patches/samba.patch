diff -ur samba-2.99.cvs.20020713.orig/source/client/smbmount.c samba-2.99.cvs.20020713/source/client/smbmount.c
--- samba-2.99.cvs.20020713.orig/source/client/smbmount.c	Wed Mar 13 19:53:02 2002
+++ samba-2.99.cvs.20020713/source/client/smbmount.c	Sat Jul 13 14:25:02 2002
@@ -726,7 +726,7 @@
 					*lp = 0;
 					pstrcpy(password,lp+1);
 					got_pass = True;
-					memset(strchr_m(opteq+1,'%')+1,'X',strlen(password));
+					memset(strchr_m(opteq+1,'%')+1,'\0',strlen(password));
 				}
 				if ((lp=strchr_m(username,'/'))) {
 					*lp = 0;
@@ -736,7 +736,7 @@
 				  !strcmp(opts, "password")) {
 				pstrcpy(password,opteq+1);
 				got_pass = True;
-				memset(opteq+1,'X',strlen(password));
+				memset(opteq+1,'\0',strlen(password));
 			} else if(!strcmp(opts, "credentials")) {
 				pstrcpy(credentials,opteq+1);
 			} else if(!strcmp(opts, "netbiosname")) {
@@ -836,7 +836,7 @@
 			*p = 0;
 			pstrcpy(password,p+1);
 			got_pass = True;
-			memset(strchr_m(getenv("USER"),'%')+1,'X',strlen(password));
+			memset(strchr_m(getenv("USER"),'%')+1,'\0',strlen(password));
 		}
 		strupper(username);
 	}
diff -ur samba-2.99.cvs.20020713.orig/source/pam_smbpass/pam_smb_passwd.c samba-2.99.cvs.20020713/source/pam_smbpass/pam_smb_passwd.c
--- samba-2.99.cvs.20020713.orig/source/pam_smbpass/pam_smb_passwd.c	Wed May  8 23:05:37 2002
+++ samba-2.99.cvs.20020713/source/pam_smbpass/pam_smb_passwd.c	Sat Jul 13 14:23:11 2002
@@ -189,6 +189,11 @@
 
     } else if (flags & PAM_UPDATE_AUTHTOK) {
 
+/*
+	The following has been commented out per Steve Langasek
+	<vorlon@debian.org> instructions. It's about Debian bug
+	#113763.
+*/
 #if 0
         /* We used to return when this flag was set, but that breaks
            password synchronization when /other/ tokens are expired.  For
diff -ur samba-2.99.cvs.20020713.orig/source/script/installbin.sh samba-2.99.cvs.20020713/source/script/installbin.sh
--- samba-2.99.cvs.20020713.orig/source/script/installbin.sh	Tue Mar 12 19:21:02 2002
+++ samba-2.99.cvs.20020713/source/script/installbin.sh	Sat Jul 13 14:23:11 2002
@@ -22,9 +22,11 @@
  chmod $INSTALLPERMS $BINDIR/$p2
 
  # this is a special case, mount needs this in a specific location
- if [ $p2 = smbmount ]; then
-   ln -sf $BINDIR/$p2 /sbin/mount.smbfs
- fi
+# Commented out for the Debian Samba package. We take care of this
+#	important symlink in debian/rules. (peloy@debian.org)
+# if [ $p2 = smbmount ]; then
+#   ln -sf $BINDIR/$p2 /sbin/mount.smbfs
+# fi
 done
 
 
diff -ur samba-2.99.cvs.20020713.orig/source/script/installswat.sh samba-2.99.cvs.20020713/source/script/installswat.sh
--- samba-2.99.cvs.20020713.orig/source/script/installswat.sh	Mon Oct 15 00:15:31 2001
+++ samba-2.99.cvs.20020713/source/script/installswat.sh	Sat Jul 13 14:23:11 2002
@@ -56,8 +56,8 @@
 for f in $SRCDIR../docs/htmldocs/*.html; do
       FNAME=$SWATDIR/help/`basename $f`
       echo $FNAME
-      cp $f $FNAME || echo Cannot install $FNAME. Does $USER have privileges?
-      chmod 0644 $FNAME
+      ln -s ../../../doc/samba-doc/htmldocs/`basename $f` $FNAME || echo Cannot install $FNAME. Does $USER have privileges?
+#      chmod 0644 $FNAME
 done
 
 # Install "server-side" includes
@@ -73,7 +73,10 @@
 
 # Install Using Samba book
 
-if [ "x$BOOKDIR" != "x" ]; then
+# For Debian we do not install anything here, we just create a symlink
+#	pointing to /usr/share/doc/samba-doc/htmldocs/using_samba/ in
+#	debian/rules (peloy@debian.org)
+if /bin/false; then
 
     # Create directories
 
diff -ur samba-2.99.cvs.20020713.orig/source/smbd/service.c samba-2.99.cvs.20020713/source/smbd/service.c
--- samba-2.99.cvs.20020713.orig/source/smbd/service.c	Wed Jul 10 23:53:39 2002
+++ samba-2.99.cvs.20020713/source/smbd/service.c	Sat Jul 13 14:23:11 2002
@@ -867,6 +867,14 @@
 		change_to_root_user();
 	}
 
+	/* If our root postexec command includes a call to 'unmount', we want
+	   to make sure we aren't blocking the mount point. */
+	/* I think this patch should go here, but I am not sure since
+	   the code looks very different than in Samba 2.2.2. Will come
+	   back later; should check what change_to_root_user() does. Eloy.-
+	vfs_ChDir(conn,"/");
+	/*
+
 	change_to_root_user();
 	/* execute any "root postexec = " line */
 	if (*lp_rootpostexec(SNUM(conn)))  {
diff -ur samba-2.99.cvs.20020713.orig/source/smbwrapper/smbsh.c samba-2.99.cvs.20020713/source/smbwrapper/smbsh.c
--- samba-2.99.cvs.20020713.orig/source/smbwrapper/smbsh.c	Wed Jan 30 00:08:41 2002
+++ samba-2.99.cvs.20020713/source/smbwrapper/smbsh.c	Sat Jul 13 14:29:07 2002
@@ -36,7 +36,7 @@
 int main(int argc, char *argv[])
 {
 	char *p, *u;
-	char *libd = dyn_BINDIR;
+	char *libd = dyn_LIBDIR;
 	pstring line, wd;
 	int opt;
 	extern char *optarg;
diff -ur samba-2.99.cvs.20020713.orig/source/web/diagnose.c samba-2.99.cvs.20020713/source/web/diagnose.c
--- samba-2.99.cvs.20020713.orig/source/web/diagnose.c	Wed Jun 26 07:17:11 2002
+++ samba-2.99.cvs.20020713/source/web/diagnose.c	Sat Jul 13 14:23:11 2002
@@ -53,6 +53,7 @@
 	static struct cli_state cli;
 	extern struct in_addr loopback_ip;
 
+	loopback_ip.s_addr = htonl((127 << 24) + 1);
 	if (!cli_initialise(&cli))
 		return False;
 
