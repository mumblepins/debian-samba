Goal: Change install paths to better respect FHS. This needs fhs-newpaths.patch
      to introduce new path variables and fhs-filespaths.patch to
      associate files with these

Fixes: #49011

Status wrt upstream: The "lock dir" related parts will no longer be
                     needed in 3.4 and 3.4 will allow to configure locations
                     for "lock directory", "state directory" and 
                     "cache directory" in smb.conf

Index: samba-3.3.0rc2/source/param/loadparm.c
===================================================================
--- samba-3.3.0rc2.orig/source/param/loadparm.c
+++ samba-3.3.0rc2/source/param/loadparm.c
@@ -120,6 +120,9 @@
 	char *szAddPrinterCommand;
 	char *szDeletePrinterCommand;
 	char *szOs2DriverMap;
+#ifdef FHS_COMPATIBLE
+	char *szLockDirStub;
+#endif
 	char *szLockDir;
 	char *szPidDir;
 	char *szRootdir;
@@ -3705,6 +3708,26 @@
 		.enum_list	= NULL,
 		.flags		= FLAG_ADVANCED,
 	},
+#ifdef FHS_COMPATIBLE
+	{
+		.label		= "lock directory",
+		.type		= P_STRING,
+		.p_class	= P_GLOBAL,
+		.ptr		= &Globals.szLockDirStub,
+		.special	= NULL,
+		.enum_list	= NULL,
+		.flags		= 0,
+	},
+	{
+		.label		= "lock dir",
+		.type		= P_STRING,
+		.p_class	= P_GLOBAL,
+		.ptr		= &Globals.szLockDirStub,
+		.special	= NULL,
+		.enum_list	= NULL,
+		.flags		= 0,
+	},
+#else
 	{
 		.label		= "lock directory",
 		.type		= P_STRING,
@@ -3723,6 +3746,7 @@
 		.enum_list	= NULL,
 		.flags		= FLAG_HIDE,
 	},
+#endif
 	{
 		.label		= "pid directory",
 		.type		= P_STRING,
Index: samba-3.3.0rc2/source/m4/check_path.m4
===================================================================
--- samba-3.3.0rc2.orig/source/m4/check_path.m4
+++ samba-3.3.0rc2/source/m4/check_path.m4
@@ -26,9 +26,9 @@
 pammodulesdir="${libdir}/security"
 configdir="${libdir}"
 swatdir="\${prefix}/swat"
-codepagedir="\${MODULESDIR}"
-statedir="\${LOCKDIR}"
-cachedir="\${LOCKDIR}"
+codepagedir="\${prefix}/share/samba"
+statedir="\${VARDIR}/lib/samba"
+cachedir="\${VARDIR}/cache/samba"
 localedir="\${prefix}/share/locale"
 
 AC_ARG_WITH(fhs,
@@ -43,10 +43,10 @@
     test "${libdir}" || libdir="\${prefix}/lib"
     modulesdir="${libdir}/samba"
     configdir="\${sysconfdir}/samba"
-    swatdir="\${DATADIR}/samba/swat"
-    codepagedir="\${MODULESDIR}"
+    swatdir="\${prefix}/swat"
+    codepagedir="\${prefix}/share/samba"
     statedir="\${VARDIR}/lib/samba"
-    cachedir="\${VARDIR}/lib/samba"
+    cachedir="\${VARDIR}/cache/samba"
     AC_DEFINE(FHS_COMPATIBLE, 1, [Whether to use fully FHS-compatible paths])
     ;;
   esac])
Index: samba-3.3.0rc2/source/configure
===================================================================
--- samba-3.3.0rc2.orig/source/configure
+++ samba-3.3.0rc2/source/configure
@@ -2245,7 +2245,7 @@
 swatdir="\${prefix}/swat"
 codepagedir="\${MODULESDIR}"
 statedir="\${LOCKDIR}"
-cachedir="\${LOCKDIR}"
+cachedir="\${prefix}/cache/samba"
 localedir="\${prefix}/share/locale"
 
 
@@ -2262,7 +2262,7 @@
     modulesdir="${libdir}/samba"
     configdir="\${sysconfdir}/samba"
     swatdir="\${DATADIR}/samba/swat"
-    codepagedir="\${MODULESDIR}"
+    codepagedir="\${prefix}/share/samba"
     statedir="\${VARDIR}/lib/samba"
     cachedir="\${VARDIR}/lib/samba"
 
